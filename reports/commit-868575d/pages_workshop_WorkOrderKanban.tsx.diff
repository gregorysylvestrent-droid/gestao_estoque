diff --git a/pages/workshop/WorkOrderKanban.tsx b/pages/workshop/WorkOrderKanban.tsx
index f144ea4..4c09256 100644
--- a/pages/workshop/WorkOrderKanban.tsx
+++ b/pages/workshop/WorkOrderKanban.tsx
@@ -1,14 +1,21 @@
-import React, { useState, useMemo } from 'react';
-import { WorkOrder, WorkOrderStatus, Mechanic, WORK_ORDER_STATUS_LABELS, WORK_ORDER_TYPE_LABELS, SERVICE_CATEGORY_LABELS } from '../../types';
+﻿﻿import React, { useState, useMemo, useEffect, useRef } from 'react';
+import { WorkOrder, WorkOrderStatus, Mechanic, Vehicle, WORK_ORDER_STATUS_LABELS, WORK_ORDER_TYPE_LABELS, SERVICE_CATEGORY_LABELS, WORK_ORDER_PRIORITY_LABELS } from '../../types';
 import { formatCurrency } from '../../utils/format';
+import { NewWorkOrderModal } from './components/NewWorkOrderModal';
 
 interface WorkOrderKanbanProps {
   workOrders: WorkOrder[];
   mechanics: Mechanic[];
+  vehicles: Vehicle[];
   onUpdateStatus: (orderId: string, newStatus: WorkOrderStatus) => void;
+  onUpdateOrder: (orderId: string, updates: Partial<WorkOrder>) => Promise<void>;
   onAssignMechanic: (orderId: string, mechanicId: string) => void;
-  onCreateOrder: () => void;
+  onCreateOrder: (order: Partial<WorkOrder>) => Promise<void>;
   onViewOrder: (order: WorkOrder) => void;
+  onLockOrder: (orderId: string) => Promise<void>;
+  onUnlockOrder: (orderId: string) => Promise<void>;
+  currentUserId?: string;
+  onError?: (message: string, error?: unknown) => void;
 }
 
 type FilterType = 'all' | 'preventiva' | 'corretiva' | 'urgente';
@@ -39,57 +46,186 @@ const PRIORITY_COLORS: Record<string, string> = {
   urgente: 'bg-red-100 text-red-600'
 };
 
+const TimerDisplay: React.FC<{ totalSeconds: number; lastStatusChange?: string; isActive: boolean }> = ({ 
+  totalSeconds, 
+  lastStatusChange, 
+  isActive 
+}) => {
+  const [displaySeconds, setDisplaySeconds] = useState(totalSeconds);
+
+  useEffect(() => {
+    setDisplaySeconds(totalSeconds);
+    
+    if (!isActive || !lastStatusChange) return;
+
+    const interval = setInterval(() => {
+      const start = new Date(lastStatusChange).getTime();
+      const now = new Date().getTime();
+      const diff = Math.floor((now - start) / 1000);
+      setDisplaySeconds(totalSeconds + diff);
+    }, 1000);
+
+    return () => clearInterval(interval);
+  }, [totalSeconds, lastStatusChange, isActive]);
+
+  const formatDuration = (seconds: number) => {
+    const h = Math.floor(seconds / 3600);
+    const m = Math.floor((seconds % 3600) / 60);
+    const s = seconds % 60;
+    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
+  };
+
+  return (
+    <div className={`flex items-center gap-1 text-xs font-mono ${isActive ? 'text-green-600 dark:text-green-400 font-bold' : 'text-slate-500'}`}>
+      <svg className={`w-3.5 h-3.5 ${isActive ? 'animate-pulse' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
+        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
+      </svg>
+      <span>{formatDuration(displaySeconds)}</span>
+    </div>
+  );
+};
+
 export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
   workOrders,
   mechanics,
+  vehicles,
   onUpdateStatus,
+  onUpdateOrder,
   onAssignMechanic,
   onCreateOrder,
-  onViewOrder
+  onViewOrder,
+  onLockOrder,
+  onUnlockOrder,
+  currentUserId,
+  onError
 }) => {
   const [filterType, setFilterType] = useState<FilterType>('all');
   const [filterPriority, setFilterPriority] = useState<FilterPriority>('all');
   const [searchTerm, setSearchTerm] = useState('');
   const [selectedMechanic, setSelectedMechanic] = useState<string>('all');
+  const [isNewOrderModalOpen, setIsNewOrderModalOpen] = useState(false);
+  const [editingOrder, setEditingOrder] = useState<WorkOrder | undefined>(undefined);
+  const isDraggingRef = useRef(false);
 
   const filteredOrders = useMemo(() => {
-    return workOrders.filter(order => {
-      if (filterType !== 'all' && order.type !== filterType) return false;
-      if (filterPriority !== 'all' && order.priority !== filterPriority) return false;
-      if (selectedMechanic !== 'all' && order.mechanicId !== selectedMechanic) return false;
-      if (searchTerm) {
-        const term = searchTerm.toLowerCase();
-        const matchesPlate = order.vehiclePlate.toLowerCase().includes(term);
-        const matchesModel = order.vehicleModel?.toLowerCase().includes(term) ?? false;
-        const matchesId = order.id.toLowerCase().includes(term);
-        const matchesDescription = order.description.toLowerCase().includes(term);
-        if (!matchesPlate && !matchesModel && !matchesId && !matchesDescription) return false;
-      }
-      return true;
-    });
-  }, [workOrders, filterType, filterPriority, selectedMechanic, searchTerm]);
+    try {
+      const safeOrders = Array.isArray(workOrders) ? workOrders : [];
+      return safeOrders.filter(order => {
+        if (!order) return false;
+        if (filterType !== 'all' && order.type !== filterType) return false;
+        if (filterPriority !== 'all' && order.priority !== filterPriority) return false;
+        if (selectedMechanic !== 'all' && order.mechanicId !== selectedMechanic) return false;
+        if (searchTerm) {
+          const term = searchTerm.toLowerCase();
+          const matchesPlate = String(order.vehiclePlate || '').toLowerCase().includes(term);
+          const matchesModel = String(order.vehicleModel || '').toLowerCase().includes(term);
+          const matchesId = String(order.id || '').toLowerCase().includes(term);
+          const matchesDescription = String(order.description || '').toLowerCase().includes(term);
+          if (!matchesPlate && !matchesModel && !matchesId && !matchesDescription) return false;
+        }
+        return true;
+      });
+    } catch (error) {
+      console.error('Erro ao filtrar ordens de servico', error);
+      onError?.('Erro ao processar ordens de serviço.', error);
+      return [];
+    }
+  }, [workOrders, filterType, filterPriority, selectedMechanic, searchTerm, onError]);
 
   const ordersByColumn = useMemo(() => {
-    return COLUMNS.reduce((acc, status) => {
-      acc[status] = filteredOrders.filter(o => o.status === status);
-      return acc;
-    }, {} as Record<WorkOrderStatus, WorkOrder[]>);
-  }, [filteredOrders]);
+    try {
+      return COLUMNS.reduce((acc, status) => {
+        acc[status] = filteredOrders.filter(o => o?.status === status);
+        return acc;
+      }, {} as Record<WorkOrderStatus, WorkOrder[]>);
+    } catch (error) {
+      console.error('Erro ao agrupar ordens de servico', error);
+      onError?.('Erro ao agrupar ordens de serviço.', error);
+      return { aguardando: [], em_execucao: [], aguardando_pecas: [], finalizada: [], cancelada: [] };
+    }
+  }, [filteredOrders, onError]);
 
   const handleDragStart = (e: React.DragEvent, orderId: string) => {
+    isDraggingRef.current = true;
     e.dataTransfer.setData('orderId', orderId);
+    e.dataTransfer.effectAllowed = 'move';
   };
 
   const handleDragOver = (e: React.DragEvent) => {
     e.preventDefault();
+    e.dataTransfer.dropEffect = 'move';
   };
 
   const handleDrop = (e: React.DragEvent, newStatus: WorkOrderStatus) => {
     e.preventDefault();
     const orderId = e.dataTransfer.getData('orderId');
-    if (orderId) {
+    const order = workOrders.find((item) => item.id === orderId);
+
+    if (orderId && order && order.status !== newStatus) {
       onUpdateStatus(orderId, newStatus);
     }
+
+    setTimeout(() => {
+      isDraggingRef.current = false;
+    }, 0);
+  };
+
+  const handleEditOrder = async (order: WorkOrder) => {
+    try {
+      const hasSessionUser = Boolean(String(currentUserId || '').trim());
+
+      if (order.lockedBy && hasSessionUser && order.lockedBy !== currentUserId) {
+        onError?.('Esta OS está sendo editada por outro usuário.');
+        return;
+      }
+
+      if (hasSessionUser) {
+        try {
+          await onLockOrder(order.id);
+        } catch (error) {
+          console.warn('Falha ao bloquear OS para edição. Abrindo modal mesmo assim.', error);
+        }
+      }
+
+      onViewOrder(order);
+      setEditingOrder(order);
+      setIsNewOrderModalOpen(true);
+    } catch (error) {
+      console.error('Erro ao abrir OS para edicao', error);
+      onError?.('Erro ao abrir OS para edição.', error);
+    }
+  };
+
+  const handleCloseModal = async () => {
+    try {
+      if (editingOrder && currentUserId) {
+        await onUnlockOrder(editingOrder.id);
+      }
+    } catch (error) {
+      console.error('Erro ao liberar OS', error);
+      onError?.('Erro ao liberar OS para outros usuários.', error);
+    } finally {
+      setIsNewOrderModalOpen(false);
+      setEditingOrder(undefined);
+    }
+  };
+
+  const handleSaveOrder = async (orderData: Partial<WorkOrder>) => {
+    try {
+      if (!orderData.vehiclePlate) {
+        onError?.('Selecione um veículo válido.');
+        return;
+      }
+      if (editingOrder) {
+        await onUpdateOrder(editingOrder.id, orderData);
+      } else {
+        await onCreateOrder(orderData);
+      }
+      await handleCloseModal();
+    } catch (error) {
+      console.error('Erro ao salvar OS', error);
+      onError?.('Erro ao salvar OS.', error);
+    }
   };
 
   return (
@@ -105,7 +241,7 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
           </p>
         </div>
         <button
-          onClick={onCreateOrder}
+          onClick={() => setIsNewOrderModalOpen(true)}
           className="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors flex items-center gap-2"
         >
           <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
@@ -139,9 +275,9 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
               className="px-3 py-2 border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-white"
             >
               <option value="all">Todos os tipos</option>
-              <option value="preventiva">Preventiva</option>
-              <option value="corretiva">Corretiva</option>
-              <option value="urgente">Urgente</option>
+              {Object.entries(WORK_ORDER_TYPE_LABELS).map(([key, label]) => (
+                <option key={key} value={key}>{label}</option>
+              ))}
             </select>
             <select
               value={filterPriority}
@@ -149,9 +285,9 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
               className="px-3 py-2 border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-white"
             >
               <option value="all">Todas prioridades</option>
-              <option value="normal">Normal</option>
-              <option value="alta">Alta</option>
-              <option value="urgente">Urgente</option>
+              {Object.entries(WORK_ORDER_PRIORITY_LABELS).map(([key, label]) => (
+                <option key={key} value={key}>{label}</option>
+              ))}
             </select>
             <select
               value={selectedMechanic}
@@ -197,12 +333,23 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
 
               {/* Cards */}
               <div className="p-3 space-y-3 overflow-y-auto flex-1">
-                {orders.map((order) => (
+                {orders.map((order) => {
+                  const services = Array.isArray(order.services) ? order.services : [];
+                  const parts = Array.isArray(order.parts) ? order.parts : [];
+                  return (
                   <div
                     key={order.id}
                     draggable
                     onDragStart={(e) => handleDragStart(e, order.id)}
-                    onClick={() => onViewOrder(order)}
+                    onDragEnd={() => {
+                      setTimeout(() => {
+                        isDraggingRef.current = false;
+                      }, 0);
+                    }}
+                    onClick={() => {
+                      if (isDraggingRef.current) return;
+                      handleEditOrder(order);
+                    }}
                     className="bg-white dark:bg-slate-800 rounded-lg p-4 border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-all cursor-pointer group"
                   >
                     {/* Card Header */}
@@ -212,7 +359,7 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
                           <span className="px-2 py-0.5 text-xs font-medium rounded bg-slate-900 dark:bg-slate-700 text-white">
                             {order.id}
                           </span>
-                          <span className={`px-2 py-0.5 text-xs font-medium rounded ${TYPE_COLORS[order.type]}`}>
+                          <span className={`px-2 py-0.5 text-xs font-medium rounded ${TYPE_COLORS[order.type] || 'bg-slate-100 text-slate-600'}`}>
                             {WORK_ORDER_TYPE_LABELS[order.type]}
                           </span>
                         </div>
@@ -223,8 +370,8 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
                           {order.vehicleModel || 'Modelo não informado'}
                         </p>
                       </div>
-                      <span className={`px-2 py-0.5 text-xs font-medium rounded ${PRIORITY_COLORS[order.priority]}`}>
-                        {order.priority === 'urgente' ? 'Urgente' : order.priority === 'alta' ? 'Alta' : 'Normal'}
+                      <span className={`px-2 py-0.5 text-xs font-medium rounded ${PRIORITY_COLORS[order.priority] || 'bg-slate-100 text-slate-600'}`}>
+                        {WORK_ORDER_PRIORITY_LABELS[order.priority]}
                       </span>
                     </div>
 
@@ -234,19 +381,19 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
                     </p>
 
                     {/* Services */}
-                    {order.services.length > 0 && (
+                    {services.length > 0 && (
                       <div className="flex flex-wrap gap-1 mb-3">
-                        {order.services.slice(0, 3).map((service, idx) => (
+                        {services.slice(0, 3).map((service, idx) => (
                           <span
                             key={idx}
                             className="px-2 py-0.5 text-xs bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded"
                           >
-                            {SERVICE_CATEGORY_LABELS[service.category]}
+                            {SERVICE_CATEGORY_LABELS[service.category] || 'Serviço'}
                           </span>
                         ))}
-                        {order.services.length > 3 && (
+                        {services.length > 3 && (
                           <span className="px-2 py-0.5 text-xs bg-slate-100 dark:bg-slate-700 text-slate-500 rounded">
-                            +{order.services.length - 3}
+                            +{services.length - 3}
                           </span>
                         )}
                       </div>
@@ -269,17 +416,22 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
                         )}
                       </div>
                       <div className="flex items-center gap-3">
-                        {order.parts.length > 0 && (
+                        {parts.length > 0 && (
                           <div className="flex items-center gap-1 text-xs text-amber-600">
                             <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                               <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                             </svg>
-                            <span>{order.parts.filter(p => p.status === 'pendente').length} peças</span>
+                            <span>{parts.filter(p => p.status === 'pendente').length} peças</span>
                           </div>
                         )}
                         <span className="text-xs text-slate-400">
-                          {new Date(order.openedAt).toLocaleDateString('pt-BR')}
+                        {order.openedAt ? new Date(order.openedAt).toLocaleDateString('pt-BR') : '--'}
                         </span>
+                        <TimerDisplay 
+                          totalSeconds={order.totalSeconds || 0}
+                          lastStatusChange={order.lastStatusChange}
+                          isActive={order.isTimerActive || false}
+                        />
                       </div>
                     </div>
 
@@ -287,20 +439,21 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
                     {status === 'em_execucao' && (
                       <div className="mt-3">
                         <div className="h-1.5 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
-                          <div 
+                          <div
                             className="h-full bg-blue-500 rounded-full"
-                            style={{ 
-                              width: `${(order.services.filter(s => s.completed).length / order.services.length) * 100}%` 
+                            style={{
+                              width: `${services.length > 0 ? (services.filter(s => s.completed).length / services.length) * 100 : 0}%`
                             }}
                           />
                         </div>
                         <p className="text-xs text-slate-500 mt-1">
-                          {order.services.filter(s => s.completed).length}/{order.services.length} serviços
+                          {services.filter(s => s.completed).length}/{services.length} serviços
                         </p>
                       </div>
                     )}
                   </div>
-                ))}
+                );
+                })}
                 
                 {orders.length === 0 && (
                   <div className="text-center py-8">
@@ -312,6 +465,22 @@ export const WorkOrderKanban: React.FC<WorkOrderKanbanProps> = ({
           );
         })}
       </div>
+
+      <NewWorkOrderModal
+        isOpen={isNewOrderModalOpen}
+        onClose={handleCloseModal}
+        onSave={handleSaveOrder}
+        mechanics={mechanics}
+        vehicles={vehicles}
+        initialData={editingOrder}
+      />
     </div>
   );
 };
+
+
+
+
+
+
+
